# 攻略编辑器功能说明

## 功能概述

攻略编辑器是一个用于编写和管理宝可梦对战攻略的工具，支持：

1. **全局战术攻略编写**：编写通用的对战策略和技巧
2. **指定精灵攻略编写**：为特定精灵编写详细攻略
3. **文档导入**：从文本文件（.txt, .md, .json）导入攻略内容
4. **RAG系统集成**：编写的攻略会自动保存，并可通过脚本导入到RAG知识库，供ExpertAI使用

---

## 功能特性

### 1. 三种编写模式

#### 全局战术攻略
- 编写通用的对战策略和技巧
- 不针对特定精灵，适用于整体战术指导
- 示例：队伍构建原则、属性克制策略、常见对战技巧

#### 指定精灵攻略
- 为特定精灵编写详细攻略
- 包含推荐配置、对线策略、队伍搭配等
- 支持搜索和选择精灵

#### 导入文档
- 支持从文件导入攻略内容
- 支持拖拽上传
- 支持格式：.txt, .md, .json

### 2. 攻略管理

- **保存攻略**：保存到 `RAG/data/raw/strategy/user/` 目录
- **查看攻略**：通过API查看已保存的攻略列表
- **删除攻略**：支持删除已保存的攻略

### 3. RAG系统集成

编写的攻略可以通过Python脚本导入到RAG知识库，供ExpertAI（难度5）使用。

---

## 使用方法

### 1. 访问攻略编辑器

打开浏览器，访问：
```
http://localhost:8080/strategy-editor.html
```

或从首页点击"攻略编辑器"卡片。

### 2. 编写攻略

#### 全局战术攻略

1. 选择"全局战术攻略"模式
2. 输入攻略标题
3. 选择对战格式（Gen 9 OU、VGC 2024等）
4. 编写攻略内容
5. 点击"保存攻略"

#### 指定精灵攻略

1. 选择"指定精灵攻略"模式
2. 在左侧精灵列表中选择或搜索精灵
3. 输入攻略标题
4. 选择对战格式
5. 编写攻略内容
6. 点击"保存攻略"

#### 导入文档

1. 选择"导入文档"模式
2. 点击上传区域选择文件，或拖拽文件到上传区域
3. 文件内容会自动加载到编辑器
4. 可以修改标题和格式
5. 点击"保存攻略"

### 3. 攻略内容建议

推荐的攻略内容结构：

```
【精灵定位】
说明精灵在队伍中的定位和作用。

【推荐配置】
- 特性：xxx
- 道具：xxx
- 技能：xxx, xxx, xxx, xxx
- 努力值：xxx/xxx/xxx/xxx/xxx/xxx

【对线策略】
说明如何对线各种常见对手。

【队伍搭配】
推荐适合的队友和组合。

【注意事项】
重要的使用技巧和注意事项。
```

### 4. 导入攻略到RAG系统

保存攻略后，需要运行Python脚本将其导入RAG知识库：

```bash
# 导入所有用户攻略
python RAG/scripts/ingest_user_strategies.py

# 强制更新已存在的攻略
python RAG/scripts/ingest_user_strategies.py --update

# 只导入特定精灵的攻略
python RAG/scripts/ingest_user_strategies.py --pokemon Pikachu
```

导入后，ExpertAI在进行对战时可以查询这些攻略作为参考。

---

## API接口

### 保存攻略

```
POST /api/strategies
Content-Type: application/json

{
  "pokemon": "Pikachu",  // 可选，全局攻略为null
  "title": "攻略标题",
  "content": "攻略内容...",
  "format": "gen9ou",    // 可选，默认gen9ou
  "metadata": {          // 可选
    "author": "user"
  }
}
```

### 获取攻略列表

```
GET /api/strategies                    // 获取所有攻略列表
GET /api/strategies?pokemon=Pikachu   // 获取特定精灵攻略
GET /api/strategies?global=true       // 获取全局攻略
GET /api/strategies/:pokemon          // 获取特定精灵攻略（路径参数）
```

### 获取攻略统计

```
GET /api/strategies/stats
```

### 删除攻略

```
DELETE /api/strategies/delete/:filename
```

---

## 数据存储

### 存储位置

攻略文件保存在：
```
pokemmo myself/RAG/data/raw/strategy/user/
```

### 文件格式

攻略文件为JSON格式，示例：

```json
{
  "metadata": {
    "source": "user",
    "type": "pokemon_strategy",
    "pokemon": "Pikachu",
    "title": "皮卡丘攻略",
    "format": "gen9ou",
    "createdAt": "2025-01-16T10:00:00.000Z",
    "author": "user"
  },
  "data": {
    "pokemon": "Pikachu",
    "title": "皮卡丘攻略",
    "strategy": "攻略内容...",
    "text": "攻略内容...",
    "format": "gen9ou"
  }
}
```

---

## 配置说明

### API服务器地址

在攻略编辑器页面左侧，可以配置API服务器地址，默认为：
```
http://localhost:3071
```

如果后端服务器运行在其他地址，请修改此配置。

---

## 常见问题

### 1. 保存攻略失败

**原因**：
- 后端服务器未启动
- API服务器地址配置错误
- 网络连接问题

**解决**：
1. 确认后端服务器已启动（`cd poke-proxy-server && node battle-server.js`）
2. 检查API服务器地址配置
3. 检查浏览器控制台错误信息

### 2. 无法导入攻略到RAG系统

**原因**：
- Python环境未配置
- RAG系统依赖未安装
- 攻略文件格式错误

**解决**：
1. 确保已安装Python 3.8+
2. 安装RAG系统依赖：`pip install -r RAG/requirements.txt`
3. 检查攻略文件是否为有效JSON格式

### 3. ExpertAI未使用攻略

**原因**：
- 攻略未导入到RAG知识库
- RAG系统未正确配置
- LLM API密钥未设置

**解决**：
1. 运行导入脚本：`python RAG/scripts/ingest_user_strategies.py`
2. 确认RAG系统配置正确
3. 检查环境变量 `DASHSCOPE_API_KEY` 是否设置

---

## 技术实现

### 架构

```
前端 (strategy-editor.html)
  ↓ HTTP API
后端 (StrategyController)
  ↓
Domain层 (StrategyManager)
  ↓
文件系统 (RAG/data/raw/strategy/user/)
  ↓ Python脚本
RAG知识库 (ingest_user_strategies.py)
  ↓
ExpertAI查询使用
```

### 文件结构

```
pokemmo myself/
├── strategy-editor.html                    # 前端页面
├── poke-proxy-server/
│   ├── controllers/
│   │   └── StrategyController.js          # 控制器
│   ├── domain/strategies/
│   │   └── StrategyManager.js             # 领域层
│   └── server/
│       └── strategyApiEndpoint.js         # API端点
└── RAG/
    └── scripts/
        └── ingest_user_strategies.py      # 导入脚本
```

---

## 更新日志

### 2025-01-16
- 初始版本发布
- 支持三种编写模式
- 支持文档导入
- RAG系统集成

---

## 参考文档

- [项目开发文档](../项目开发文档.md)
- [后端模块说明](../modules/后端模块说明.md)
- [RAG系统说明](../../RAG/README.md)


