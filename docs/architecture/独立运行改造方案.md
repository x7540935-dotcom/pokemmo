# ç‹¬ç«‹è¿è¡Œæ”¹é€ æ–¹æ¡ˆï¼šç§»é™¤å¤–éƒ¨ Pokemon Showdown ä¾èµ–

> æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°†é¡¹ç›®æ”¹é€ ä¸ºä½¿ç”¨ npm åŒ…å½¢å¼çš„ Pokemon Showdownï¼Œå®ç°è§£å‹åå®‰è£…ä¾èµ–å³å¯ç›´æ¥è¿è¡Œã€‚

---

## ğŸ“‹ é—®é¢˜åˆ†æ

### å½“å‰é—®é¢˜

1. **ç¡¬ç¼–ç è·¯å¾„ä¾èµ–**ï¼š
   - `ShowdownAdapter.js` ä¸­ç¡¬ç¼–ç è·¯å¾„ï¼š`../../../../pokemon-showdown`
   - `BattleManager.js` ä¸­ä¹Ÿæœ‰ç›´æ¥å¼•ç”¨ï¼š`../../../pokemon-showdown/dist/sim`
   - è¦æ±‚é¡¹ç›®å¿…é¡»æ”¾åœ¨ç‰¹å®šç›®å½•ç»“æ„ä¸­

2. **å¤–éƒ¨ä¾èµ–**ï¼š
   - éœ€è¦æ‰‹åŠ¨å‡†å¤‡ `pokemon-showdown` ç›®å½•
   - è·¯å¾„ä¾èµ–å¯¼è‡´æ— æ³•ç‹¬ç«‹è¿è¡Œ

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ npm åŒ…ï¼ˆæ¨èï¼‰

Pokemon Showdown æœ‰å®˜æ–¹ npm åŒ…ï¼š`@pkmn/sim`

**ä¼˜ç‚¹**ï¼š
- âœ… é€šè¿‡ npm è‡ªåŠ¨ç®¡ç†ä¾èµ–
- âœ… ç‰ˆæœ¬é”å®šï¼Œä¿è¯ä¸€è‡´æ€§
- âœ… æ— éœ€å¤–éƒ¨æ–‡ä»¶
- âœ… è·¨å¹³å°å…¼å®¹

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦éªŒè¯ API å…¼å®¹æ€§ï¼ˆå¯èƒ½æœ‰ç»†å¾®å·®å¼‚ï¼‰

### æ–¹æ¡ˆäºŒï¼šå°† Pokemon Showdown æºç åŒ…å«åœ¨é¡¹ç›®ä¸­

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨æ§åˆ¶ç‰ˆæœ¬
- âœ… å¯ä»¥ä¿®æ”¹æºç 

**ç¼ºç‚¹**ï¼š
- âŒ å‹ç¼©åŒ…ä¼šå¾ˆå¤§ï¼ˆPokemon Showdown æºç çº¦ 50-100 MBï¼‰
- âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†æ›´æ–°

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ npm åŒ… + é™çº§ç­–ç•¥

ä¼˜å…ˆä½¿ç”¨ npm åŒ…ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™å°è¯•æœ¬åœ°è·¯å¾„ï¼ˆå‘åå…¼å®¹ï¼‰

---

## ğŸ”§ æ¨èå®ç°ï¼šæ–¹æ¡ˆä¸‰ï¼ˆnpm åŒ… + é™çº§ï¼‰

### 1. æ·»åŠ  npm ä¾èµ–

ä¿®æ”¹ `poke-proxy-server/package.json`ï¼š

```json
{
  "dependencies": {
    "@pkmn/sim": "^0.5.3",
    // ... å…¶ä»–ä¾èµ–
  }
}
```

**æ³¨æ„**ï¼š`@pkmn/sim` æ˜¯ Pokemon Showdown çš„ TypeScript é‡å†™ç‰ˆæœ¬ï¼ŒAPI åŸºæœ¬å…¼å®¹ã€‚

æˆ–è€…ä½¿ç”¨åŸå§‹åŒ…ï¼š
```json
{
  "dependencies": {
    "pokemon-showdown": "https://github.com/smogon/pokemon-showdown.git",
    // æˆ–è€…å‘å¸ƒåˆ° npm çš„ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
  }
}
```

### 2. ä¿®æ”¹ ShowdownAdapter.js

å°†è·¯å¾„è§£ææ”¹ä¸ºä¼˜å…ˆä½¿ç”¨ npm åŒ…ï¼Œé™çº§åˆ°æœ¬åœ°è·¯å¾„ï¼š

```javascript
class ShowdownAdapter {
  constructor() {
    this._showdownPath = null;
    this._useNpmPackage = false;
    // ... å…¶ä»–åˆå§‹åŒ–
  }

  /**
   * è·å– Pokemon Showdown æ¨¡å—
   * ä¼˜å…ˆçº§ï¼š1. npm åŒ… 2. æœ¬åœ°è·¯å¾„
   */
  _resolveShowdownModule(modulePath) {
    // ä¼˜å…ˆå°è¯•ä½¿ç”¨ npm åŒ…
    try {
      if (modulePath === 'dist/sim') {
        return require('@pkmn/sim');
      } else if (modulePath === 'dist/sim/teams') {
        return require('@pkmn/sim/teams');
      } else if (modulePath === 'dist/data/random-battles/gen9/teams') {
        // @pkmn/sim çš„ RandomTeams è·¯å¾„å¯èƒ½ä¸åŒï¼Œéœ€è¦è°ƒæ•´
        return require('@pkmn/sim/data/random-battles/gen9/teams');
      }
    } catch (e) {
      // npm åŒ…ä¸å¯ç”¨ï¼Œé™çº§åˆ°æœ¬åœ°è·¯å¾„
    }

    // é™çº§ï¼šä½¿ç”¨æœ¬åœ°è·¯å¾„
    const localPath = path.resolve(this.getShowdownPath(), modulePath);
    return require(localPath);
  }
}
```

### 3. ä¿®æ”¹æ‰€æœ‰å¼•ç”¨ç‚¹

éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- `poke-proxy-server/adapters/pokemon-showdown/ShowdownAdapter.js`
- `poke-proxy-server/core/BattleManager.js`ï¼ˆå¦‚æœç›´æ¥å¼•ç”¨ï¼‰

---

## ğŸ“ å…·ä½“ä¿®æ”¹æ­¥éª¤

### æ­¥éª¤ 1ï¼šä¿®æ”¹ package.json

### æ­¥éª¤ 2ï¼šä¿®æ”¹ ShowdownAdapter.js

### æ­¥éª¤ 3ï¼šæµ‹è¯•éªŒè¯

### æ­¥éª¤ 4ï¼šæ›´æ–°æ–‡æ¡£

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å…¼å®¹æ€§**ï¼š
   - `@pkmn/sim` å¯èƒ½ä¸åŸå§‹ç‰ˆæœ¬æœ‰ç»†å¾®å·®å¼‚
   - éœ€è¦æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ç‚¹

2. **RandomTeams è·¯å¾„**ï¼š
   - ä¸åŒç‰ˆæœ¬çš„è·¯å¾„å¯èƒ½ä¸åŒ
   - éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

3. **å‘åå…¼å®¹**ï¼š
   - ä¿ç•™é™çº§ç­–ç•¥ï¼Œæ”¯æŒæœ¬åœ°è·¯å¾„
   - ç¡®ä¿ç°æœ‰éƒ¨ç½²ä¸å—å½±å“

---

## ğŸ¯ æœ€ç»ˆç›®æ ‡

ç”¨æˆ·æ”¶åˆ°å‹ç¼©åŒ…åï¼Œåªéœ€ï¼š

```bash
cd "pokemmo myself"
npm install
cd poke-proxy-server
npm install
# å³å¯è¿è¡Œï¼Œæ— éœ€å¤–éƒ¨ Pokemon Showdown æ–‡ä»¶
```

